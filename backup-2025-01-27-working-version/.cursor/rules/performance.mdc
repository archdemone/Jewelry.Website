---
alwaysApply: true
---

1) Sandbox usage (local safety)

Only edit in sandbox: C:\Users\dimam\OneDrive\Desktop\Jewelry.Website\sandbox-20250820-183517.
Baseline (main) is read-only unless you promote.

Ports are fixed: baseline :3000, sandbox :3001. No other ports.

Start modes

Dev (baseline prod + sandbox hot reload): npm run dev:safe

Prod both (parity/perf): npm run run:both

Stop first, always: npm run stop (frees 3000/3001).

Promote flow (no manual copy):

sandbox → npm run sandbox:patch

main → npm run sandbox:apply → commit

2) Environments & secrets

Local: .env.local in baseline; sandbox inherits its own env (set SANDBOX=1 when running).

Future Live (production):

No .env.production committed. Store secrets in GitHub Actions Secrets (or your host’s secret store).

Validate env at boot (Zod or a tiny validator) and fail fast on missing vars.

Service worker:

Register prod SW only on baseline; use sandbox SW (different scope/cache) on :3001.

If things look stale, unregister all SWs and hard-reload.

3) Git workflow (simple & safe)

Branches:

main = stable.

Feature work → sandbox branch (e.g. sandbox/feat-xyz) in the worktree.

Commits:

Commit in sandbox branch as you iterate.

Promote via patch → apply to main → commit → push.

Pull Requests (optional but good):

Push sandbox branch and open a PR into main.

Squash merge to keep history clean.